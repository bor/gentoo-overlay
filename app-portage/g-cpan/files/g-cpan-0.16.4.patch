diff --git a/bin/g-cpan b/bin/g-cpan
old mode 100644
new mode 100755
index a30d271..25572ae
--- a/bin/g-cpan
+++ b/bin/g-cpan
@@ -532,8 +532,8 @@ sub generatePackageInfo
                     foreach (@data)
                     {
                         my $thisfile = (split(/ /, $_))[1];
-						$thisfile =~ s{\.([A-Za-z]{1,3})$}{};
-                        if (($thisfile =~ m{$eb}x) && !defined($passed_to_install{$eb}))
+                        $thisfile =~ s{\.([A-Za-z]{1,3})$}{};
+                        if ( ($thisfile =~ m{\Q$eb\E}x) && !defined($passed_to_install{$eb}) )
 						{
     						spinner_stop();
 							print_info("$ebuild_wanted is part of the core perl install");
@@ -717,16 +717,18 @@ sub generatePackageInfo
                             }
                         }
 
+                        my $module_version = $gcpan_run->{cpan}{lc($original_ebuild)}{version};
                         my $description = $gcpan_run->{'cpan'}{lc($original_ebuild)}{'description'};
 
                         print $EBUILD <<"HERE";
-# Copyright 1999-2010 Gentoo Foundation
+# Copyright 1999-2012 Gentoo Foundation
 # Distributed under the terms of the GNU General Public License v2
 # This ebuild generated by $prog $VERSION
 
 EAPI="2"
 
 MODULE_AUTHOR="$module_author"
+MODULE_VERSION="$module_version"
 $module_a_ext
 $module_section
 inherit perl-module
diff --git a/lib/Gentoo/CPAN.pm b/lib/Gentoo/CPAN.pm
index 379e864..481b06a 100644
--- a/lib/Gentoo/CPAN.pm
+++ b/lib/Gentoo/CPAN.pm
@@ -6,7 +6,7 @@ use warnings;
 use File::Spec;
 use CPAN;
 use File::Path;
-use YAML;
+use YAML ();
 use YAML::Node;
 use Memoize;
 use Cwd qw(getcwd abs_path cwd);
@@ -313,15 +313,8 @@ sub FindDeps {
         if ( -f $object ) {
             my $abs_path = abs_path($object);
             if ( $object eq "META\.yml" ) {
-
                 # Do YAML parsing if you can
-                my $b_n = dirname($abs_path);
-                $b_n = basename($b_n);
-                open(YAML,"$abs_path");
-                my @yaml = <YAML>;
-                close(YAML);
-                if ( check_yaml(@yaml) ) {
-                my $arr = YAML::Load(@yaml);
+                if ( my $arr = yaml_load($abs_path) ) {
                 foreach my $type qw(configure_requires requires build_requires recommends) {
                     if ( my $ar_type = $arr->{$type} ) {
                         foreach my $module ( keys %{$ar_type} ) {
@@ -397,7 +390,7 @@ sub FindDeps {
                             my @list = split( ',', $p );
                             foreach my $pa (@list) {
                                 $pa =~ s/\n|\s+|\'//mg;
-                                if ($pa =~ /=~/) {
+                                if ( $pa =~ /=~|\?\(/ ) {
                                     my ($module, $version ) = eval $pa;
                                     next if ((!defined($module)) or
                                             ( $module eq "" ) or 
@@ -438,10 +431,11 @@ sub FindDeps {
 
 }
 
-sub check_yaml {
-    my @yaml = @_;
-    return 1 if YAML::Load(@yaml);
-    return 0;
+sub yaml_load {
+    my $filepath = shift;
+    my $yaml = eval { YAML::LoadFile($filepath); };
+    return if $@;
+    return $yaml;
 }
 sub transformCPAN {
     my $self = shift;
